---
- name: "Unarchive backend js files"
  become: yes
  unarchive:
    src: /root/project/backend.tar.gz
    dest: /root/project

- name: Stop pm2
  command: |
    pm2 stop backend
    pm2 delete backend

- name: Build node service
  become: yes
  command: |
    pwd
    ls
    cd backend
    npm i
    npm audit fix --audit-level=critical --force
    npm run build

- name: Start pm2 service after build
  command: |
    cd backend
    pm2 start npm --name backend -- start